# v1.2.5 - 2026-02-17

This patch delivers full interactive command support in the TUI and fixes several output rendering issues.

## Highlights

### Hybrid PTY for interactive commands
The executor now uses a **hybrid PTY** approach when run from the TUI:
- The child's **stdin and controlling terminal** use a PTY, so programs that open `/dev/tty` (e.g., `sudo` for password prompts) work correctly.
- **Stdout and stderr remain as pipes**, so programs like `fastfetch` detect pipe mode and produce simple, viewport-friendly output instead of cursor-positioned rendering.
- User keystrokes (password entry, confirmations) are forwarded from the TUI into the running process via the PTY.

### Live output streaming
- The non-PTY executor path now streams output **live** via `io.MultiWriter` instead of buffering until command completion.
- The TUI viewport shows run output immediately — no keypress required.

### Viewport rendering fix
- The detail view now correctly shows **run logs** during and after a run, instead of the static detail text overwriting live output on every render frame.
- Run logs are cleared when navigating back so stale output doesn't persist.

## Bug fixes
- **Doubled output** when stdout==stderr in PTY mode.
- **UI border corruption** from escape sequences split across read chunk boundaries (added `trailingIncompleteEscape` buffering).
- **Nil pointer panic** in `writeOutputs`/`checkExecutionError` when PTY starter returned nil buffers.
- **Truncated output** for programs like `fastfetch` — read buffer increased from 256→4096 bytes; escape-sequence carry buffer flushed on EOF.
- **Sanitizer improvements** — cursor-forward (`CUF`) converted to spaces, cursor-horizontal-absolute (`CHA`) to a separator, SGR colors preserved, destructive CSI sequences stripped.
- **Empty list on launch** — the command list appeared empty on startup until a resize or keypress. `Init()` now returns a proper `initDoneMsg` so `Update()` populates the list on the first frame.
- **Run output not visible** in detail view when the command has version history — the versions-panel rendering path unconditionally overwrote the viewport with static detail text, hiding run logs.
- **Cannot scroll run output** after a run completes — `GotoBottom()` was called on every render frame when logs existed, resetting scroll position. Now only auto-scrolls while the run is actively in progress.
- **Enter on versions panel** now loads the selected version's full detail into the left preview pane and switches focus there, so you can read and scroll the version content.

## Quality
- Added `gocyclo` (threshold >10) to pre-commit hooks.
- Refactored `executorAdapter.Run` and integration tests to keep cyclomatic complexity under 10.
- All `golangci-lint` and `gocyclo` checks pass.

## New features
- **Delete version (D):** In the versions panel, pressing `D` on a highlighted version prompts for confirmation and deletes that specific version record. The bottom bar shows the new shortcut.
- **Enter on versions:** Pressing Enter on a version in the versions panel now loads the version's full detail (description, commands, author, creation date) into the left preview pane and switches focus there.

## Tests added
- Escape-sequence splitting across chunk boundaries
- EOF flush of incomplete escape buffer
- FD-reader wrapping and non-terminal stdin behavior
- PTY simulated behavior (hybrid mode)
- Sanitizer: SGR preservation, alt-screen removal, CR normalization, CUF→spaces, CHA→separator
- Headless test: prompts appear in viewport, not footer

## Upgrade notes
- No DB schema changes required.
- Simply upgrade to v1.2.5. Interactive commands in the TUI will work automatically when running in a real terminal.
